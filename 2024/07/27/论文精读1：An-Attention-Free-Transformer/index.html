<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>论文精读1：An Attention Free Transformer | 诺亚方舟</title><meta name="author" content="弘树"><meta name="copyright" content="弘树"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1 Abstract我们介绍了无注意力transformer(AFT)，这是Transformer的有效变体，消除了对点积自注意力的需要。在AFT层中，键和值首先与一组学习到的位置偏置组合在一起，其结果以element-wise的方式与查询相乘。 这个新操作的内存复杂度与上下文大小和特征维度都是线性的，这使得它兼容于大的输入和模型大小。我们还介绍了AFT-local和AFT-conv两种模型变体，">
<meta property="og:type" content="article">
<meta property="og:title" content="论文精读1：An Attention Free Transformer">
<meta property="og:url" content="http://zhouzimu.top/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/index.html">
<meta property="og:site_name" content="诺亚方舟">
<meta property="og:description" content="1 Abstract我们介绍了无注意力transformer(AFT)，这是Transformer的有效变体，消除了对点积自注意力的需要。在AFT层中，键和值首先与一组学习到的位置偏置组合在一起，其结果以element-wise的方式与查询相乘。 这个新操作的内存复杂度与上下文大小和特征维度都是线性的，这使得它兼容于大的输入和模型大小。我们还介绍了AFT-local和AFT-conv两种模型变体，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://th.bing.com/th/id/R.c711422d32a03183ff82c805e6837a5b?rik=hgP3vHF2D%2fyCGA&riu=http%3a%2f%2fwww.deeplearningdaily.com%2fwp-content%2fuploads%2f2021%2f06%2funofficial-pytorch-implementation-of-attention-free-transformer-aft-layers_60c5308a5335f.jpeg&ehk=tQubmdKcevvpCuBVL2VoQQ80Z%2bRnw1ORYVBowyf4VyE%3d&risl=&pid=ImgRaw&r=0">
<meta property="article:published_time" content="2024-07-27T00:52:10.000Z">
<meta property="article:modified_time" content="2024-11-14T03:08:36.000Z">
<meta property="article:author" content="弘树">
<meta property="article:tag" content="AFT">
<meta property="article:tag" content="论文精读">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://th.bing.com/th/id/R.c711422d32a03183ff82c805e6837a5b?rik=hgP3vHF2D%2fyCGA&riu=http%3a%2f%2fwww.deeplearningdaily.com%2fwp-content%2fuploads%2f2021%2f06%2funofficial-pytorch-implementation-of-attention-free-transformer-aft-layers_60c5308a5335f.jpeg&ehk=tQubmdKcevvpCuBVL2VoQQ80Z%2bRnw1ORYVBowyf4VyE%3d&risl=&pid=ImgRaw&r=0"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="http://zhouzimu.top/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 弘树","link":"链接: ","source":"来源: 诺亚方舟","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '论文精读1：An Attention Free Transformer',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-14 11:08:36'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/myStyle.css"><link rel="stylesheet" href="/css/tianli_gpt.css"><meta name="generator" content="Hexo 6.3.0"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/pic_editor_1635545191.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">123</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">45</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-asterisk"></i><span> 归档</span></a></li><li><a class="site-page child" href="/update/"><i class="fa-fw fas fa-archive"></i><span> 更新日志</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('https://th.bing.com/th/id/R.c711422d32a03183ff82c805e6837a5b?rik=hgP3vHF2D%2fyCGA&amp;riu=http%3a%2f%2fwww.deeplearningdaily.com%2fwp-content%2fuploads%2f2021%2f06%2funofficial-pytorch-implementation-of-attention-free-transformer-aft-layers_60c5308a5335f.jpeg&amp;ehk=tQubmdKcevvpCuBVL2VoQQ80Z%2bRnw1ORYVBowyf4VyE%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0')"><nav id="nav"><span id="blog-info"><a href="/" title="诺亚方舟"><span class="site-name">诺亚方舟</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-asterisk"></i><span> 归档</span></a></li><li><a class="site-page child" href="/update/"><i class="fa-fw fas fa-archive"></i><span> 更新日志</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">论文精读1：An Attention Free Transformer</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2024-07-27T00:52:10.000Z" title="发表于 2024-07-27 08:52:10">2024-07-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%A7%91%E7%A0%94/">科研</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>31分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="论文精读1：An Attention Free Transformer"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-Abstract"><a href="#1-Abstract" class="headerlink" title="1 Abstract"></a>1 Abstract</h1><p>我们介绍了无注意力transformer(AFT)，这是Transformer的有效变体，消除了对点积自注意力的需要。在AFT层中，键和值首先与<strong>一组学习到的位置偏置组合</strong>在一起，其结果以element-wise的方式与查询相乘。</p>
<p>这个新操作的内存复杂度与上下文大小和特征维度都是<strong>线性</strong>的，这使得它兼容于大的输入和模型大小。我们还介绍了<code>AFT-local</code>和<code>AFT-conv</code>两种模型变体，它们在保持全局连通性的同时利用了局域性和空间权重共享的思想。</p>
<p>我们在两个自回归建模任务(<code>CIFAR10</code>和<code>Enwik8</code>)以及图像识别任务(<code>ImageNet-1K</code>分类)上进行了广泛的实验。实验表明，AFT在所有基准测试中都表现出具有竞争力的性能，同时提供了出色的效率。</p>
<hr>
<h1 id="2-Introduction"><a href="#2-Introduction" class="headerlink" title="2 Introduction"></a>2 Introduction</h1><p>以Transformers为代表的自注意机制推动了各种机器学习问题的发展，包括语言理解和计算机视觉应用。与卷积神经网络(<code>cnn</code>)或循环神经网络(<code>rnn</code>)等经典模型架构不同，Transformer可以在序列中的<strong>每对元素之间进行直接交互</strong>，这使得它们在捕获长期依赖关系方面特别强大。</p>
<p>然而，Transformer需要很高的计算成本。这一挑战的原因是需要执行<strong>具有平方时间和空间复杂性的注意力操作，而不是上下文大小</strong>。</p>
<blockquote>
<p>因为设计到矩阵乘法，所以时间复杂度为平方级别</p>
</blockquote>
<p>这使得Transformer难以扩展到具有大上下文大小的输入。最近的许多工作都致力于解决Transformer的可伸缩性问题。这里的共同思想是<strong>近似全局注意力操作</strong>，使用的技术包括稀疏性、局域敏感散列、低秩分解、核近似等。</p>
<p>在本文中，我们提出了一个不使用或近似标准点积注意力的计算模块。因此，我们将我们的模型命名为无注意力Transformer(AFT)。与点积注意力类似，AFT由查询、键和值(Q、K、V)三个量的交互作用组成。不同之处在于，在AFT中，键和值（上下文）首先组合在一起加上一系列学习到的position biases。然后将查询与简化后的上下文结合起来，使用element-wise乘法，图2给出了一个说明。</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_It0lGwCQEV.png"></p>
<p>AFT保持上下文中任意两点之间的直接交互，这是<strong>点积注意力</strong>的主要优势。事实上，AFT可以被解释为在<strong>注意力头的数量与模型的特征维度相同</strong>的情况下计算注意力，而attention maps不需要明确计算(详见3.1节)。这导致内存复杂度线性w.r.t。输入和模型大小。</p>
<blockquote>
<p>注意力图：Q与K进行点积得到的矩阵</p>
</blockquote>
<p>在最近的“线性化注意力”工作中也发现了Q、K、V的重新排列计算顺序。不同之处在于，AFT以element-wise方式结合了K和V，而所有的线性注意力论文都依赖于矩阵点积。后一种方法导致复杂度与模型的特征维数成二次方，这对大模型尺寸不友好。与其他Transformer相比，AFT的复杂度分析见表1。</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_UBBu-YZrFr.png"></p>
<p>根据经验，我们观察到经过训练的Transformer往往表现出广泛的局部模式（见图1）。这促使我们提出AFT的两种变体：<strong>AFT-local</strong>和<strong>AFT-conf</strong>。</p>
<p>在<code>AFT-local</code>中，学习到的位置偏置被限制在局部区域，同时保持全局连通性。</p>
<p>在<code>AFT-conv</code>中通过强制空间权重共享进一步扩展了这一设计，有效地使其成为具有全局感受野的CNN的变体。</p>
<p>我们证明，<strong>局部约束不仅提供了更好的参数和计算效率，而且大大提高了模型在所有任务中的性能</strong>。</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_EW8FkS0sEz.png"></p>
<p>我们用AFT进行了图像自回归建模、字符级语言建模和图像分类任务的实验。我们证明，AFT提供了具有竞争力的性能，通常与标准变压器和其他变体相匹配或击败，同时提供了卓越的效率。</p>
<p>我们还对AFT的几种设计选择进行了广泛的消融研究，并讨论了其独特的特性，如与Transformer的兼容性、稀疏性和可变大小的输入。</p>
<hr>
<h1 id="3-Multi-Head-Attention"><a href="#3-Multi-Head-Attention" class="headerlink" title="3 Multi-Head Attention"></a>3 Multi-Head Attention</h1><p>Transformer的核心是Multi-Head Attention（<code>MHA</code>）操作。在自注意模式中，给定输入序列$X \in R^{T \times d}$，头的数量为h，<code>MHA</code>对每个头$i$执行缩放的点积注意，定义为：</p>
<p>$$<br>f_{i}(X)&#x3D;\sigma\left(\frac{Q_{i}\left(K_{i}\right)^{T}}{\sqrt{d_{k}}}\right) V_{i}, s.t. Q_{i}&#x3D;X W_{i}^{Q}, K_{i}&#x3D;X W_{i}^{K}, V_{i}&#x3D;X W_{i}^{V},<br>$$</p>
<p>$$<br>f_{i}(X)&#x3D;\sigma\left(\frac{Q_{i}\left(K_{i}\right)^{T}}{\sqrt{d_{k}}}\right) V_{i}, i&#x3D;1,2,…h<br>$$</p>
<p>其中$W_{i}^{Q} \in R^{d \times d_{k}}$，$W_{i}^{K} \in R^{d \times d_{k}}$，$W_{i}^{V} \in R^{d \times d_{v}}$是头$i$的线性变换，$\sigma$是默认设置为<code>softmax</code>函数的非线性（应用于矩阵的每一行）。$d_k$和$d_v$分别是键和值的维度。<code>MHA</code>沿着通道维度连接$h$个注意力头的输出，从而产生特征维度$hd_v$。除非另有说明，否则我们假设$d_k&#x3D;d_v$和$h&#x3D;d_k$。这意味着查询、键和值在每个头中都是相同的维度，并且输出维度与输入维度匹配。为什么要有这个假设？</p>
<hr>
<h1 id="4-Methodology"><a href="#4-Methodology" class="headerlink" title="4 Methodology"></a>4 Methodology</h1><h2 id="4-1-Attention-Free-Transformer"><a href="#4-1-Attention-Free-Transformer" class="headerlink" title="4.1 Attention Free Transformer"></a>4.1 Attention Free Transformer</h2><p>之前的注意力机制：</p>
<p>$$<br>\operatorname{Attention}(\mathrm{Q}, \mathrm{K}, \mathrm{V})&#x3D;\operatorname{Softmax}\left(\frac{\mathrm{QK}^{\mathrm{T}}}{\sqrt{\mathrm{d}_{\mathrm{k}}}}\right) \mathrm{V}<br>$$</p>
<p>我们现在定义了Attention Free Transformer（AFT），它是<code>MHA</code>的插件替代品，无需更改Transformer的其他架构方面。给定输入$X$，AFT首先将其线性变换为$Q&#x3D;X W^{Q}, K&#x3D;X W^{K}, V&#x3D;X W^{V}$（这部分和之前的注意力机制计算相同），然后执行以下操作：</p>
<p>$$<br>Y&#x3D;f(X) ; Y_{t}&#x3D;\sigma_{q}\left(Q_{t}\right) \odot \frac{\sum_{t^{\prime}&#x3D;1}^{T} \exp \left(K_{t^{\prime}}+w_{t, t^{\prime}}\right) \odot V_{t^{\prime}}}{\sum_{t^{\prime}&#x3D;1}^{T} \exp \left(K_{t^{\prime}}+w_{t, t^{\prime}}\right)}<br>$$</p>
<p>其中$\odot$是元素乘积；$σ_q$是应用于查询非线性，默认为<code>sigmoid</code>；$w \in R^{T \times T}$是学习到的成对位置偏差（见图2）。</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_I1ajEwCNi6.png"></p>
<p>换句话说，对于每个目标位置$t$，AFT计算$V$的加权平均，其结果与具有element-wise乘法的$Q$相结合。特别地，权重仅由键和一组学习的成对位置偏差$w$组成。这提供了直接的优势，即不需要计算和存储昂贵的注意力矩阵，同时像<code>MHA</code>那样保持查询和值之间的全局交互。</p>
<p>为了进一步了解AFT与<code>MHA</code>的关系，我们可以将上述公式改写为：</p>
<p>$$<br>Y_{t}^{i}&#x3D;&lt;a_{t}^{i}, V^{i}&gt;, s.t. a_{t}^{i}&#x3D;\frac{\sigma_{q}\left(Q_{t}^{i}\right) \exp \left(K^{i}+w_{t}\right)}{\sum_{t^{\prime}&#x3D;1}^{T} \exp \left(K_{t^{\prime}}^{i}+w_{t, t^{\prime}}\right)}, i&#x3D;1,2, \ldots, d, t&#x3D;1,2, \ldots, T<br>$$</p>
<p>这里我们使用上标$i$来索引矩阵的特征维度；$&lt;·，·&gt;$表示向量的点积。在这种重新排列的形式中，我们能够再次用注意力来表达AFT。</p>
<p>具体来说，对于每个位置，我们对每个维度都有一个注意力向量$a_{t}^{i} \in R^{T}$，由$Q,K,w$组成。换句话说，<strong>AFT可以被解释为用与特征维度一样多的头来执行隐含注意力</strong>，其中注意力矩阵采用因式分解形式。</p>
<h2 id="4-2-AFT-变体"><a href="#4-2-AFT-变体" class="headerlink" title="4.2 AFT 变体"></a>4.2 AFT 变体</h2><h3 id="4-2-1-AFT-Full"><a href="#4-2-1-AFT-Full" class="headerlink" title="4.2.1 AFT-Full"></a>4.2.1 AFT-Full</h3><p>我们将上述公式中定义的AFT的基本版本表示为AFT-Full。</p>
<h3 id="4-2-2-AFT-Local"><a href="#4-2-2-AFT-Local" class="headerlink" title="4.2.2 AFT-Local"></a>4.2.2 AFT-Local</h3><p>在许多应用中，局部性是一种重要的归纳偏置，<code>CNNs</code>和最近Transformer的相关工作已经利用了这一点。此外，我们发现经过训练的标准Transformer往往表现出广泛的局部注意力模式。具体地说，我们可视化了<code>ImagenetNet</code>预训练的视觉转换器（<code>ViT</code>），它由12层组成，每个层有6个头。</p>
<p>为了可视化，我们忽略分类标记，并将每一层的注意力张量重塑为6×196×196（<code>ViT</code>的特征图的空间大小为14×14）。然后，我们从ImageNet验证集中采样了256幅图像。对于每一层和每一个头，我们计算查询位置和图像的平均相对二维关注度。这导致了一组大小为12×6×27×273的注意力图。</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_EW8FkS0sEz.png"></p>
<p>在图1中展示了每2层的注意力（完整可视化见附录）。我们看到，相对注意力图表现出强烈的局部性（如清晰度所示），尤其是在较低的层中。这激发了AFT的一种变体，称为<code>AFT-local</code>，其中我们只在局部应用一组学习到的相对位置偏差：</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image.png"></p>
<p>这里$s \leq T$是局部窗口大小。<code>AFT-local</code>提供了进一步的计算节省，包括参数数量和时间&#x2F;空间复杂性。注意，与<code>local Transformer</code>不同，无论窗口大小s如何，AFT-local都保持全局连通性。在实验中，我们验证了这种设计选择的有效性。</p>
<h3 id="4-2-3-AFT-Simple"><a href="#4-2-3-AFT-Simple" class="headerlink" title="4.2.3 AFT-Simple"></a>4.2.3 AFT-Simple</h3><p><code>AFT-local</code>的一种极端形式是当$s&#x3D;0$（窗口为0）时，即没有学习到位置偏差。这就产生了一个极其简单的AFT版本，其中我们有：</p>
<p>$$<br>Y_{t}&#x3D;\sigma_{q}\left(Q_{t}\right) \odot \frac{\sum_{t^{\prime}&#x3D;1}^{T} \exp \left(K_{t^{\prime}}\right) \odot V_{t^{\prime}}}{\sum_{t^{\prime}&#x3D;1}^{T} \exp \left(K_{t^{\prime}}\right)}&#x3D;\sigma_{q}\left(Q_{t}\right) \odot \sum_{t^{\prime}&#x3D;1}^{T}(\operatorname{softmax}(K) \odot V)_{t^{\prime}}.<br>$$</p>
<p>在这个版本中，上下文缩减被进一步简化为元素操作和全局池。<code>AFT-simple</code>类似于线性化注意力，其公式为：</p>
<p>$$<br>Y_t&#x3D;\frac{\phi\left(Q_{t}\right) \sum_{t^{\prime}&#x3D;1}^{T}\left(\phi\left(K_{t^{\prime}}\right)^{T} V_{t^{\prime}}\right)}{\phi\left(Q_{t}\right) \sum_{t^{\prime}&#x3D;1}^{T} \phi\left(K_{t}\right)^{T}}<br>$$</p>
<p>然而，很容易看出，<code>AFT-simple</code>完全消除了点积运算的需要，这导致时间复杂度为$O(Td)$而不是$O(Td^2)$。</p>
<h3 id="4-2-4-AFT-Conv"><a href="#4-2-4-AFT-Conv" class="headerlink" title="4.2.4 AFT-Conv"></a>4.2.4 AFT-Conv</h3><p>我们还可以进一步扩展局部性的概念，将空间权重共享（即卷积）纳入其中。这种变体与视觉任务特别相关，因为通常需要将预训练的模型扩展到可变大小的输入。具体来说，我们让$w_{t, t^{\prime}}$的值仅取决于$t$和$t’$，即相对于给定空间网格（<code>1d</code>或<code>2d</code>）的相对位置。与<code>CNNs</code>类似，我们也可以学习多组位置偏差（我们重用<code>heads</code>的概念作为参考）。为了说明<code>#parameters</code>随着<code>#heads</code>的增加而增长，我们采用了一种设计选择来将<code>K</code>的维度与<code>#heads</code>联系起来。这使得AFT可修改为依赖于深度可分离卷积、全局池和元素操作的实现。</p>
<p>我们现在展示了具有<code>1d</code>输入的<code>AFT-conv</code>的示例，<code>2d</code>和<code>3d</code>输入可以类似地导出。我们将模型配置表示为<code>AFT-conv-h-s</code>，其中$h$是头的数量，$s$是<code>1d</code>局部窗口大小。我们现在有$w \in R^{h \times s}$，$Q, V \in R^{T \times h \times \frac{d}{h}}$，$K \in R^{T \times h}$。对于每个头部$i&#x3D;1,2, \ldots, h$，我们有：</p>
<p>$$<br>Y_{t}^{i}&#x3D;\sigma_{q}\left(Q_{t}^{i}\right) \odot \frac{\operatorname{conv1d}\left(\exp \left(K^{i}\right) \odot V^{i}, \exp \left(w^{i}\right)-1\right)+\sum_{t^{\prime}&#x3D;1}^{T} \exp \left(K_{t^{i}}^{i}\right) \odot V_{t^{\prime}}^{i}}{\operatorname{conv1d}\left(\exp \left(K^{i}\right), \exp \left(w^{i}\right)-1\right)+\sum_{t^{\prime}&#x3D;1}^{T} \exp \left(K_{t^{i}}^{i}\right)}.<br>$$</p>
<p>这里$Y_{t}^{i} \in R^{\frac{d}{h}}$、$Q^{i}, V^{i} \in R^{T \times \frac{d}{h}}$、$K^{i} \in R^{T}$、$w^{i} \in R^{s}$；</p>
<p>$conv1d(x,w)$是深度可分离的一维卷积运算，其中卷积滤波器$w$在通道维度上共享。请注意，上述公式可以很容易地理解为具有：</p>
<ol>
<li>全局连接性</li>
<li>非负卷积权重</li>
<li>复杂的除法&#x2F;乘法门控机制的专用卷积层</li>
</ol>
<p>通过实验证明，所有三个方面都对 <code>AFT-conv</code>的性能有显着贡献。</p>
<h3 id="4-2-5-参数化"><a href="#4-2-5-参数化" class="headerlink" title="4.2.5 参数化"></a>4.2.5 参数化</h3><p>参数化。根据经验，我们发现正确参数化位置偏差$w$很重要。对于<code>AFT-full</code>和<code>AFT-local</code>，我们采用 𝑤的因式分解形式：</p>
<p>$$<br>w_{t, t^{\prime}}&#x3D;u_{t}^{T} v_{t}^{\prime}, u \in R^{T \times d^{\prime}}, v \in R^{T \times d^{\prime}}<br>$$</p>
<p>其中 𝑑’是一个小的嵌入维度（例如 128）。这种简单的分解不仅大大减少了参数数量（$2Td$与$T^2$），而且还根据经验提高了模型在训练和测试中的性能。</p>
<p>对于<code>AFT-conv</code>，分解技巧不适用。相反，采用简单的重新参数化，对于每个头$i$，我们让</p>
<p>$$<br>w^{i}&#x3D;\gamma^{i} \frac{w^{i}-\operatorname{mean}\left(w^{i}\right)}{\operatorname{std}\left(w^{i}\right)}+\beta^{i}<br>$$</p>
<p>其中$\gamma \in R^{h}, \beta \in R^{h}$是可学习的增益和偏置参数，均初始化为0。</p>
<hr>
<h1 id="5-Related-Work"><a href="#5-Related-Work" class="headerlink" title="5 Related Work"></a>5 Related Work</h1><p>自从Transformer被引入以来，已经有很多尝试来解决架构中低效的主要来源，即注意力操作的平方成本。改进此操作可以实现更大的上下文大小和更高效的实现。有关高效Transformer的最新全面调查，请参阅[16]。</p>
<h2 id="5-1-近似点积"><a href="#5-1-近似点积" class="headerlink" title="5.1 近似点积"></a>5.1 近似点积</h2><p>近似点积提出用投影的内积来近似指数核，这导致了复杂性为$O(Td^2)$的线性化注意力操作。</p>
<p>然而，这些模型的$d^2$项使其难以随模型大小进行缩放，这对AFT来说不是问题。Reformers[8]将<code>LSH</code>作为点积的近似值，其中AFT完全消除了它。</p>
<h2 id="5-2-稀疏注意力"><a href="#5-2-稀疏注意力" class="headerlink" title="5.2 稀疏注意力"></a>5.2 稀疏注意力</h2><p>稀疏Transformer[7]和图像Transformer[17]提出使用固定的稀疏或局部上下文模式。视觉任务中的注意力模型（通常与卷积相结合）使用图像结构来帮助手工制作相关的空间模式来参与[18-22]。AFT局部性也借用了<strong>局部性</strong>的思想，但我们把它看作是一种偏见，而不是硬约束。这允许<code>AFT-local/AFT-conv</code>利用完整的上下文，而不是仅依赖于子集。</p>
<h2 id="5-3-上下文压缩"><a href="#5-3-上下文压缩" class="headerlink" title="5.3 上下文压缩"></a>5.3 上下文压缩</h2><p>其他方法试图学习上下文模式。Adaptive-Span Transformers[23]学习每个注意力头的范围。[24]使用聚类仅在同一聚类内的元素子集上计算点积注意力。</p>
<p><code>Linformer</code>[10]通过使用线性层压缩键和值来减少上下文的长度。压缩变换器[9]计算并更新输入序列中足够靠后的输入的简化表示，并处理这些压缩表示。AFT在很大程度上是对这些方法的补充，因为我们的重点是从操作层面提高任何给定序列的复杂性。</p>
<h2 id="5-4-消除点积注意力"><a href="#5-4-消除点积注意力" class="headerlink" title="5.4 消除点积注意力"></a>5.4 消除点积注意力</h2><p>其他方法不是限制比较的次数，而是改变用于计算注意力的运算。合成器[12]使用从输入预测的注意力权重，而不是从点积交互中导出的。[25]中引入的<code>LightConv</code>模块提出用动态轻量级深度卷积代替点积自注意，其中权重在时间维度上进行归一化。<code>Sinkhorn</code> Transformer [26]使用可微分排序操作来识别在原始序列顺序中可能不是局部的相关比较。AFT沿着这条线提供了一种不同的方法，同时强调了强大的实证性能和效率。</p>
<h2 id="5-5-MLPs-for-vision"><a href="#5-5-MLPs-for-vision" class="headerlink" title="5.5 MLPs for vision"></a>5.5 MLPs for vision</h2><p>并行工作[27，28]探讨了在视觉任务中使用<code>MLP</code>代替注意力操作。虽然AFT可以用类似的方式查看，但它也配备了更复杂的门控机制。特别是，值的权重由关键和位置偏差组成，这些偏差被归一化为非负值（类似于注意力）。</p>
<p>AFT将成为现有变压器的插件模块，无需任何架构更改和额外调整。此外，<code>AFT-conv</code>继承了<code>CNNs</code>的宝贵特性，使其能够实现卓越的参数效率、强大的性能以及处理可变大小输入的能力。</p>
<hr>
<h1 id="6-Experiments"><a href="#6-Experiments" class="headerlink" title="6 Experiments"></a>6 Experiments</h1><p>我们在三个任务上进行了实验：图像自回归建模（第6.1节）、字符级语言建模（第6.2节）和图像分类（第6.3节）。前两个基准使用AFT的因果模型（或解码器模型），而最后一个基准使用编码模型。所有实验都是以即插即用的方式设计的，其中我们获得了特定任务的基线Transformer架构，并将注意力模块替换为AFT模块。初始化、学习速率调度等超参数也直接继承自Transformer对应方法。</p>
<p>除非另有说明，否则所有实验都是在<code>8×V100</code> GPU机器上进行的。</p>
<h2 id="6-1-图像自回归建模"><a href="#6-1-图像自回归建模" class="headerlink" title="6.1 图像自回归建模"></a>6.1 图像自回归建模</h2><h3 id="6-1-1-CIFAR-10数据集"><a href="#6-1-1-CIFAR-10数据集" class="headerlink" title="6.1.1 CIFAR-10数据集"></a>6.1.1 CIFAR-10数据集</h3><ul>
<li>数据集链接：<a target="_blank" rel="noopener" href="https://www.cs.toronto.edu/~kriz/cifar.html" title="CIFAR-10 和 CIFAR-100 数据集 --- CIFAR-10 and CIFAR-100 datasets (toronto.edu)">CIFAR-10 和 CIFAR-100 数据集 — CIFAR-10 and CIFAR-100 datasets (toronto.edu)</a></li>
</ul>
<p><code>CIFAR-10</code> 和 <code>CIFAR-100</code> 是 8000 万个微小图像数据集的标记子集。它们由 Alex Krizhevsky、Vinod Nair 和 Geoffrey Hinton 收集。</p>
<p><code>CIFAR-10</code>数据集由 10 个类别的 60000 个<code>32x32</code>彩色图像组成，每个类别有 6000 个图像。有 50000 张训练图像和 10000 张测试图像。</p>
<p>数据集分为5个训练批次和1个测试批次，每个批次有10000张图像。测试批次包含从每个类别中随机选择的 1000 张图像。训练批次以随机顺序包含剩余的图像，但某些训练批次可能包含来自一个类的图像多于另一个类的图像。在它们之间，训练批次正好包含来自每个类的 5000 张图像。</p>
<p>以下是数据集中的类，以及每个类的 10 张随机图像：</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_b3k5kxewGD.png"></p>
<p>这些类是完全相互排斥的。汽车和卡车之间没有重叠。“汽车”包括轿车、SUV等。“卡车”仅包括大型卡车。两者都不包括皮卡车。</p>
<h3 id="6-1-2-实验部分"><a href="#6-1-2-实验部分" class="headerlink" title="6.1.2 实验部分"></a>6.1.2 实验部分</h3><p>在我们的第一组实验中，我们通过<strong>最小化负对数似然</strong>（<code>NLL</code>）来考虑图像自回归建模的问题。与[17]类似，我们将<code>RGB</code>图像表示为长度为H×W×3的序列，其中H、W分别为高度和宽度。每个子像素被表示为256路离散变量。我们使用<code>CIFAR-10</code>作为基准数据集。</p>
<p>我们的参考Transformer设计在很大程度上遵循[4]的设计，其中Transformer块由具有残差连接的注意力层（在我们的情况下为AFT层）和具有残差连接（前馈维度乘数设置为4）的2层<code>MLP</code>组成。层规范化（LN）[29]以“预先”的方式应用。我们采用学习的位置嵌入，并在<code>RGB</code>上使用一组共享的标记嵌入和预测头。我们在本实验中使用带有因子化参数化的AFT局部。因子分解的隐藏维度为64，u，v用$N(0,10^{−2})$初始化；局部（<code>1d</code>）窗口大小s为256。</p>
<p>我们使用<code>AdamW</code>[30]，并遵循[1]中的标准热身学习率时间表。我们使用$3×10^{−3}$的初始学习率，将0.1的权重衰减应用于所有线性变换权重，并使用0.1的丢弃率。我们采用简单的数据扩充。在训练过程中，我们首先随机水平翻转每个图像，然后从其所有子像素中添加或减去范围为[-10, 10]的值，并将得到的像素值剪裁为[0255]。我们使用交叉熵损失，对于200个训练时期，默认批量大小为128。</p>
<h4 id="与现有技术相比"><a href="#与现有技术相比" class="headerlink" title="与现有技术相比"></a><strong>与现有技术相比</strong></h4><p><code>CIFAR10</code>是图像自回归建模的一个拥挤的基准，我们将其与一些有竞争力的基线进行了比较，如表2所示。注意，<code>CIFAR10</code>具有3072的展开序列长度，这已经无法训练具有合理尺寸的完整变压器。对于标准的Transformer模型，我们采用了两种配置（L&#x3D;12，d&#x3D;512，h&#x3D;4和L&#x3D;24，d&#x3D;256，h&#x3D;2），批量大小为32，这是我们在<code>8xV100</code>GPU节点上可以容纳的最大的一个。另一个基线是Image Transformer[17]，它将注意力限制在大小为256的<code>local2d</code>窗口上。我们还将其与稀疏变换器[7]进行了比较，后者限制了对上下文元素的预先指定的稀疏子集的关注。</p>
<blockquote>
<p><strong>表2</strong>：<code>CIFAR-10</code>上的<code>NLL</code>结果，按bits&#x2F;dim评估，越低越好。速度和内存是在训练期间测量的，8个<code>V100</code>GPU的批量大小为32。AFT在此设置中实现了最先进的结果，与标准Transformer、Sparse Transformer[7]和Image Transformer[17]相比，写入速度和内存显著提高。</p>
</blockquote>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_tO4Y6krXmk.png"></p>
<p>从表2中，我们可以看到AFT local优于所有Transformer baseline。我们还观察到，更深但更窄的架构比浅但宽的基线更有效。在这种情况下，我们最好的模型在<code>CIFAR10</code>上也达到了最先进的结果，优于更大的稀疏变压器模型。在效率方面，我们在8 个<code>V100</code>GPU节点上将Transformer变体与AFT进行了基准测试。我们所有的变体都比标准Transformer和Image Transformer更快，同时只消耗一半的内存。也许令人惊讶的是，AFT simple也实现了非常有竞争力的性能，甚至超过了Image Transformer，同时提供了出色的速度和内存效率。</p>
<p><strong>因子分解的影响</strong>。我们还提供了关于AFT因子化参数化的消融实验。为了做到这一点，我们用一个初始参数化的w重新训练了表2中性能最好的模型（即AFT-cal-256，L&#x3D;24，d&#x3D;256），用$N(0,0.01)$初始化。从表3中，我们可以看出，因子化版本不仅显著节省了参数，而且提高了模型在训练和测试方面的性能。</p>
<h4 id="6-1-2-2-Factorized的影响"><a href="#6-1-2-2-Factorized的影响" class="headerlink" title="6.1.2.2 Factorized的影响"></a>6.1.2.2 Factorized的影响</h4><p>我们还提供了关于AFT因子化参数化作用的消融。为了做到这一点，我们用一个初始参数化的$w$重新训练了表2中性能最好的模型（即AFT-cal-256，L&#x3D;24，d&#x3D;256），用$N(0,10^{−2})$初始化。从表3中，我们可以看出，因子化版本不仅显著节省了参数，而且提高了模型在训练和测试方面的性能。</p>
<p>表3：通过对<code>CIFAR-10</code>的$w$自回归建模评估的位置偏差因子化参数化的影响</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_KwDCjpOpmc.png"></p>
<h2 id="6-2-语言建模"><a href="#6-2-语言建模" class="headerlink" title="6.2 语言建模"></a>6.2 语言建模</h2><h3 id="6-2-1-补充"><a href="#6-2-1-补充" class="headerlink" title="6.2.1 补充"></a>6.2.1 补充</h3><p>语言建模是预测文档中下一个单词或字符的任务。此技术可用于训练语言模型，这些模型可以进一步应用于广泛的自然语言任务，如文本生成、文本分类和问答。</p>
<p>模型的语言建模能力是使用交叉熵和困惑度来衡量的。一些用于评估语言建模的数据集包括 WikiText-103、One Billion Word、Text8、C4、The Pile 等。</p>
<h3 id="6-2-2-Enwik8数据集"><a href="#6-2-2-Enwik8数据集" class="headerlink" title="6.2.2 Enwik8数据集"></a>6.2.2 Enwik8数据集</h3><p><code>Enwik8</code>数据集是 2006 年 3 月 3 日英语维基百科 XML 转储的前 100,000,000 （<code>100M</code>）字节，通常用于<strong>衡量模型压缩数据</strong>的能力。</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_5FT6M2KOyC.png"></p>
<h3 id="6-2-3-实验部分"><a href="#6-2-3-实验部分" class="headerlink" title="6.2.3 实验部分"></a>6.2.3 实验部分</h3><p>我们将AFT应用于<code>Enwik8</code>[31]上的字符级语言建模，这是另一个流行的自回归建模基准。我们遵循[32]中的标准预处理程序和训练&#x2F;验证&#x2F;测试拆分。我们的基础Transformer参考是一个12层512维8头架构，具有2048个前馈维度。对于第一组实验，我们使用1024的序列长度。我们的训练方案与之前的实验基本相同，只是我们将权重衰减增加到0.5，并以128的批量训练100个时期。我们评估窗口大小为32和$d’&#x3D;256$的AFT-local。</p>
<p>我们还比较了几种有效的Transformer模型，即Reformer[8]、Synthesizer[12]、Linear Transformer[11]和Performer[13]。</p>
<blockquote>
<p><strong>表4</strong>：<code>Enwik8</code>结果，以每字符比特数（<code>bpc</code>）为单位测量，越低越好。比较的基线是Reformer[8]、Synthesizer[12]（其性能最好的密集版本）、Linear Transformer[11]和Performer[13]。L、d、h、T分别表示块的数量（深度）、特征的尺寸、头的数量和序列长度<br>速度和内存是在训练时间内测量的，在8个 <code>V100</code>GPU节点上的批量大小为128。Linear Transformer和Performer都是用定制的<code>CUDA</code>内核（<a target="_blank" rel="noopener" href="http://github.com/idiap/fast-transformers" title="github.com/idiap/fast-transformers">github.com&#x2F;idiap&#x2F;fast-transformers</a> ）实现的，所有其他模型都是在原生<code>Pytorch</code>中实现的</p>
</blockquote>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_iKrp4uek19.png"></p>
<p>从表4中，我们可以看到，在基本L&#x3D;12，d&#x3D;512架构的情况下，AFT实现了最低的每字符训练比特<code>bpc</code>，这是高模型容量的指标。它的测试性能比基本的Transformer稍差，但优于所有其他Transformer变体。AFT更深、更窄的体系结构在参数、速度、内存和性能方面取得了最佳平衡。它的测试<code>bpc</code>距离完整的Transformer只有0.024，而只消耗了三分之一的内存，并提供了44%的加速。AFT simple再次展示了具有竞争力的性能和卓越的效率。</p>
<h4 id="6-2-3-1-窗口大小"><a href="#6-2-3-1-窗口大小" class="headerlink" title="6.2.3.1 窗口大小"></a>6.2.3.1 窗口大小</h4><p>为了验证局部窗口大小的影响，我们对L&#x3D;24，d&#x3D;256架构进行了额外的实验，修复了所有问题，但改变了局部窗口大小。我们在表5中显示了结果，其中我们看到训练和测试<code>bpc</code>都形成了相对于窗口大小的U形，其中32个实现了最佳性能。这进一步证实了局部性确实是跨任务的有效归纳偏差。</p>
<p>表5：训练和测试<code>bpc</code>w.r.t.AFT本地窗口大小</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_0QTfjZP_HR.png"></p>
<h4 id="6-2-3-2-较长的序列大小"><a href="#6-2-3-2-较长的序列大小" class="headerlink" title="6.2.3.2 较长的序列大小"></a>6.2.3.2 较长的序列大小</h4><p>我们还对AFT适应较长序列大小的能力感兴趣。由于其简单性，人们甚至可能预期随着T的增加性能会下降。为此，我们训练了AFT–local-32，L&#x3D;24，d&#x3D;256模型，T分别增加到2048和4096。结果如表6所示。我们看到，随着T的增加，AFT能够利用更大的序列大小，并持续降低训练和测试损失。</p>
<p>表6：<code>Enwik8</code>上的T增加。随着T的增加，训练和测试损失都有所改善</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_pebJJtilJ7.png"></p>
<h2 id="6-3-图像分类"><a href="#6-3-图像分类" class="headerlink" title="6.3 图像分类"></a>6.3 图像分类</h2><h3 id="6-3-1-Imagenet-1K数据集"><a href="#6-3-1-Imagenet-1K数据集" class="headerlink" title="6.3.1 Imagenet-1K数据集"></a>6.3.1 Imagenet-1K数据集</h3><p><code>ImageNet</code>数据是CV领域非常出名的数据集，<code>ISLVRC</code>竞赛使用的数据集是轻量版的<code>ImageNet</code>数据集。<code>ISLVRC2012</code>是非常出名的一个数据集，在很多CV领域的论文，都会使用这个数据集对自己的模型进行测试。</p>
<p><code>ImageNet</code>是一个计算机视觉系统识别项目，是目前世界上图像识别最大的数据库。是美国斯坦福的计算机科学家，模拟人类的识别系统建立的。能够从图片中识别物体。<code>ImageNet</code>是一个非常有前景的研究项目，未来用在机器人身上，就可以直接辨认物品和人了。超过1400万的图像URL被<code>ImageNet</code>手动注释，以指示图片中的对象；</p>
<p>在至少一百万张图像中，还提供了边界框。<code>ImageNet</code>包含2万多个类别，一个典型的类别，如“气球”或“草莓”，每个类包含数百张图像。</p>
<p>在一些论文中，有的人会将这个数据叫成<code>ImageNet-1K</code> 或者<code>ISLVRC2012</code>，两者是一样的。<code>1K</code>代表的是1000个类别。用这个数据测试模型结构是很方便的。有几点原因：</p>
<ol>
<li>很多的论文都使用了此数据集，跟其他模型比较时，可以直接引用结果</li>
<li><code>ImageNet</code>的评价指标是固定的，大家都使用<code>top1</code>、<code>top5</code>等</li>
<li>可以直接看出你修改的模型结构到底有没有提高</li>
</ol>
<h3 id="6-3-2-实验部分"><a href="#6-3-2-实验部分" class="headerlink" title="6.3.2 实验部分"></a>6.3.2 实验部分</h3><p>然后，我们测试了AFT的non-causal版本，重点是图像分类任务。我们采用了Vision Transformer架构[5]，并在<code>Imagenet-1K</code>分类数据集上进行了实验。我们采用了<code>DeiT</code>[6]中的训练设置和超参数（批量大小、数据扩充、正则化和学习率调度）。</p>
<p>简言之，<code>ViT</code>将图像分割为16×16个不重叠的块，然后将具有共享权重的每个块线性投影到令牌嵌入的等价性。学习的类标记被附加到所得到的表示，从而产生长度$T&#x3D;1+\frac{H &#x2F; 16}{W &#x2F; 16}$的序列。线性分类头被附加到最终层的类标记以获得最终输出。有关型号配置的更多详细信息，请参见[5]。所有实验都是在<code>ImageNet-1K</code>数据集上进行的，没有使用额外的数据。</p>
<p>由于该任务中的序列大小相对较小（对于224×224的输入大小，T&#x3D;197），我们首先用AFT-full进行实验。因子分解后的位置偏移的隐藏维度被设置为$d’&#x3D;128$。</p>
<p>此外，我们还对AFT-conf进行了实验。在这种设置中，我们还取消了位置嵌入和类标记的使用，并在最终层的输出后应用全局平均池，然后将其输入到分类线性层。这种修改不仅简化了模型设计，而且使AFT-conv完全卷积，这是Transformer及其变体所没有的。</p>
<p>我们比较了两种baseline的Transformer配置，分别为“tiny”$(L&#x3D;12,d&#x3D;192,h&#x3D;3)$和“small”$(L&#x3D;12,d&#x3D;384,h&#x3D;6)$配置。我们还考虑了Lambda Networks[15]，它与线性化的注意力工作线密切相关。与<code>AFT-conv</code>类似，我们删除了类标记，转而应用全局平均池。我们使用了其公共实现，并应用密钥投影维度$|k|&#x3D;16$的全上下文模式（此设置调用更快的线性实现）。我们还将<code>BatchNorm</code>应用于查询，如[15]所建议的密钥投影。</p>
<blockquote>
<p>表7：<code>DeiT</code>[6]的Transformer架构的<code>Imagenet-1K</code>分类结果，<code>cropsize</code>为224。速度和内存消耗是在<code>V100</code>GPU的推理模式下测量的，批量大小为256</p>
</blockquote>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_bHE64y5803.png"></p>
<p>我们的结果如表7所示。我们首先看到，AFT-full在两种配置中都实现了与基线<code>Transformer DeiT</code>相当的性能，同时具有更好的内存占用和相似的速度。<code>AFT-conv</code>显著提高了两种配置的前1级精度（“tiny”和“small”分别提高了2%和1.1%的绝对精度），参数计数相似或更小。</p>
<p>与Lambda Networks相比，所有AFT变体都实现了相当或更好的精度，具有相当的速度和更小的内存占用。</p>
<h4 id="6-3-2-1-可视化"><a href="#6-3-2-1-可视化" class="headerlink" title="6.3.2.1 可视化"></a>6.3.2.1 可视化</h4><p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_D_TNoeFjli.png"></p>
<blockquote>
<p>图1：具有可比规模的<code>AFT-conv</code>学习到的相对位置偏差。每一行代表一个层（层索引范围为{0,2,4,6,8,10}）；每列代表一个标题。有关更完整的版本，请参阅附录。</p>
</blockquote>
<p>我们还试图将<code>AFT-conv</code>学习到的位置偏差（精确地说是$exp(w)-1$）可视化，如图1所示。请注意，出现了有趣的局部对称稀疏模式。我们在附录中表明，我们可以正则化位置偏差以实现更高的稀疏性。我们还展示了<code>AFT-conv</code>的一个极端版本，其中每个头部都分配了一个非零上下文点，同时仍然保持良好的准确性。这有效地将卷积转换为索引。</p>
<h4 id="6-3-2-2-可变大小输入"><a href="#6-3-2-2-可变大小输入" class="headerlink" title="6.3.2.2 可变大小输入"></a>6.3.2.2 可变大小输入</h4><p><code>AFT-conv</code>是完全卷积的，这意味着它可以处理与训练中不同的输入大小。我们在384个更大的crop size上测试了<code>AFT-conv</code>模型（表7的最后一行，用crop size为224进行训练）。与最初的81.0相比，这提高了81.6的精度。这使得<code>AFT-conv</code>非常适合预训练微调工作流程，正如Vision任务中经常看到的那样。</p>
<h4 id="6-3-2-3-与Transformer的兼容性"><a href="#6-3-2-3-与Transformer的兼容性" class="headerlink" title="6.3.2.3 与Transformer的兼容性"></a>6.3.2.3 与Transformer的兼容性</h4><p>尽管AFT不是为了直接近似<code>MHA</code>而设计的，但它们确实有相当大的相似性，因为在两个模型中，值向量都是用学习到的非负权重聚合的。我们假设一个模型学习到的表征可以转移到另一个模型。为了测试这一点，我们获得了一个crop size为384的预训练<code>DeiT base</code>模型。然后，我们通过用<code>DeiT</code>模型的权重初始化<code>AFT-conv</code>来训练它，不包括位置嵌入、类标记、键和查询投影。我们使用64的批处理大小，训练模型100个迭代周期。作为控制，我们还为相同数量的epoch训练一个随机初始化的<code>AFT-conv</code>。结果如表8所示。有趣的是，我们看到<code>AFT-conv</code>的微调版本比随机初始化版本的精度高得多。由此产生的模型也比原始的<code>DeiT</code>模型更准确、更快、更节省内存。</p>
<blockquote>
<p>表8：根据384×384 crops的预训练<code>DeiT base</code>，对100个epochs的<code>AFT-conv</code>进行微调。“ft”和“rand”分别代表微调和随机初始化。</p>
</blockquote>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_Wvfp2uAv2k.png"></p>
<h4 id="6-3-2-4-全局连通性"><a href="#6-3-2-4-全局连通性" class="headerlink" title="6.3.2.4 全局连通性"></a>6.3.2.4 全局连通性</h4><p><code>AFT-conv</code>（以及<code>AFT-local</code>）保持全局连接，而不管本地kernel大小如何，这与稀疏和局部注意力工作不同。为了看到这种设计的好处，我们训练了一个<code>AFT-conv</code>的退化变体，其中我们修改了方程4，在局部窗口外为$w_{t,t’}$分配−∞值（求幂后为零权重）。当使用卷积核大小为7评估此基线时，它给出了79.9的Top 1精度，而默认<code>AFT-conv</code>在相同设置下的精度为80.8，下降了0.9%（我们在各种配置中始终观察到相同的趋势）。我们假设这项技术也可以扩展到局部和稀疏的变形金刚，但将作为未来的工作。</p>
<hr>
<h1 id="7-Conclusions"><a href="#7-Conclusions" class="headerlink" title="7 Conclusions"></a>7 Conclusions</h1><p>我们推出了无注意力Transformer，它以高效的新操作取代了点积注意力Transformer。我们在一组标准基准上展示了强大的结果以及卓越的效率。我们相信，我们的模型为类似Transformer的模型打开了一个新的设计空间，并将在需要自注意力的各个领域产生影响。</p>
<hr>
<h1 id="8-Additional-Ablations"><a href="#8-Additional-Ablations" class="headerlink" title="8 Additional Ablations"></a>8 Additional Ablations</h1><h2 id="8-1-其他的消融实验"><a href="#8-1-其他的消融实验" class="headerlink" title="8.1 其他的消融实验"></a>8.1 其他的消融实验</h2><p>我们对<code>ImageNet-1K</code>分类设置进行了更多实验。</p>
<p>$w$<strong>的参数化</strong>：我们首先验证了AFT全因子化参数化的重要性。如表9所示，AFT full的非因子化参数化比因子化版本的训练和测试性能更差。</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_ZmxY5D-04j.png"></p>
<p>$w$<strong>的重参数化</strong>：对于<code>AFT-conv</code>，默认应用第3.2节中所述的重新参数化。我们验证了该设计有效地提高了模型的性能，如表10所示。</p>
<p><strong>卷积核的大小</strong>：我们还尝试了基于<code>AFT conv</code>small（384个头）改变局部窗口大小。结果如表11所示。请注意，即使内核大小非常小，为3×3，<code>AFT-conv</code>也能实现与<code>Deit</code>参考相当的性能。</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_rOTuWHTAK9.png"></p>
<p><strong>query的贡献</strong>：查询项对AFT的计算贡献很小，但它对AFT性能的贡献很大。我们用<code>AFT-conv</code>（384个头，内核大小为11×11和15×15）进行了额外的实验，在那里我们删除了查询词。结果如表12所示。</p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_lFOlcx7Zm3.png"></p>
<p><strong>key的可视化</strong>：key在AFT中起着核心作用，因为它们为有效的上下文缩减提供了依赖于内容的重新加权。为了了解它们的行为，我们在<code>ImageNet-1K</code>验证集中的随机采样图像上可视化了<code>AFT-conv</code>模型的特征图，如图9、10、11、12所示。有趣的是，我们看到随着层级别的升高，密钥逐渐演变为“对象检测器”。</p>
<blockquote>
<p>图9、10、11、12顶部：来自<code>ImageNet-1K</code>验证集的示例图像<br>底部：<code>AFT-conv</code>中key的可视化，每行对应一个层，每列对应一个头部</p>
</blockquote>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_uuPTgG7Ppz.png"></p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_XJZU8tghzW.png"></p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_p19F5RiywO.png"></p>
<p><img src="/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/image_cLNORop0q6.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://zhouzimu.top">弘树</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://zhouzimu.top/2024/07/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB1%EF%BC%9AAn-Attention-Free-Transformer/">http://zhouzimu.top/2024/07/27/论文精读1：An-Attention-Free-Transformer/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://zhouzimu.top" target="_blank">诺亚方舟</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/AFT/">AFT</a><a class="post-meta__tags" href="/tags/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/">论文精读</a></div><div class="post_share"><div class="social-share" data-image="https://th.bing.com/th/id/R.c711422d32a03183ff82c805e6837a5b?rik=hgP3vHF2D%2fyCGA&amp;riu=http%3a%2f%2fwww.deeplearningdaily.com%2fwp-content%2fuploads%2f2021%2f06%2funofficial-pytorch-implementation-of-attention-free-transformer-aft-layers_60c5308a5335f.jpeg&amp;ehk=tQubmdKcevvpCuBVL2VoQQ80Z%2bRnw1ORYVBowyf4VyE%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>码字不易，如果对你有帮助的话请喝一杯奶茶吧~</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src="/img/alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/28/%E8%AE%BA%E6%96%87AFT%E4%BB%A3%E7%A0%81%E5%A4%8D%E7%8E%B0/" title="论文AFT代码复现"><img class="cover" src="https://picx.zhimg.com/v2-d5a0214bbb3d7da73e0ed139b7e73904_720w.jpg?source=172ae18b" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">论文AFT代码复现</div></div></a></div><div class="next-post pull-right"><a href="/2024/07/26/2024%E5%B9%B4X-Team%E5%A4%8F%E4%BB%A4%E8%90%A5%E8%80%83%E6%A0%B8%E4%BB%BB%E5%8A%A12/" title="2024年X-Team夏令营考核任务2"><img class="cover" src="https://www.tju.edu.cn/__local/B/9D/9A/A049818DECF16DAEC919CC9F9C3_99A586F0_1AA68.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">2024年X-Team夏令营考核任务2</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/07/28/%E8%AE%BA%E6%96%87AFT%E4%BB%A3%E7%A0%81%E5%A4%8D%E7%8E%B0/" title="论文AFT代码复现"><img class="cover" src="https://picx.zhimg.com/v2-d5a0214bbb3d7da73e0ed139b7e73904_720w.jpg?source=172ae18b" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-28</div><div class="title">论文AFT代码复现</div></div></a></div><div><a href="/2024/08/15/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB2%EF%BC%9ATraining-Free-Layout-Control-with-Cross-Attention-Guidance/" title="论文精读2：Training-Free Layout Control with Cross-Attention Guidance"><img class="cover" src="https://github.com/silent-chen/layout-guidance/raw/gh-page/resources/teaser.png?raw=true" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-15</div><div class="title">论文精读2：Training-Free Layout Control with Cross-Attention Guidance</div></div></a></div><div><a href="/2024/08/27/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB3%EF%BC%9AGNN/" title="论文精读3：GNN技术博客"><img class="cover" src="https://pic4.zhimg.com/v2-3601304d88287b2b8e1736ded4036a43_1440w.jpg?source=172ae18b" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-27</div><div class="title">论文精读3：GNN技术博客</div></div></a></div><div><a href="/2024/09/15/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB4%EF%BC%9AGAN/" title="论文精读4：GAN"><img class="cover" src="https://i0.wp.com/bdtechtalks.com/wp-content/uploads/2018/05/Generative-adversarial-networks-GAN-min-389357362-1527503338782.png?fit=2997%2C1840&ssl=1" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-15</div><div class="title">论文精读4：GAN</div></div></a></div><div><a href="/2024/11/14/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB5%EF%BC%9ADeep-Neural-Networks-for-YouTube-Recommendations/" title="论文精读5：DNN for YouTube Rec"><img class="cover" src="https://blog.acolyer.org/wp-content/uploads/2016/09/dnn-youtube-fig-7.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-14</div><div class="title">论文精读5：DNN for YouTube Rec</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/pic_editor_1635545191.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">弘树</div><div class="author-info__description">在我坚定无比的内心，总以最坚强的节奏解开案情</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">123</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">45</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/NoyeArk"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/NoyeArk" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:horiki0@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://leetcode.cn/u/horiki/" target="_blank" title="Leetcode"><i class="fas fa-l" style="color: #59e285;"></i></a><a class="social-icon" href="https://www.kaggle.com/horiki" target="_blank" title="Kaggle"><i class="fas fa-k" style="color: #4a7dbe;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc" style="font-size: 15px;"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Abstract"><span class="toc-text">1 Abstract</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Introduction"><span class="toc-text">2 Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Multi-Head-Attention"><span class="toc-text">3 Multi-Head Attention</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Methodology"><span class="toc-text">4 Methodology</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-Attention-Free-Transformer"><span class="toc-text">4.1 Attention Free Transformer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-AFT-%E5%8F%98%E4%BD%93"><span class="toc-text">4.2 AFT 变体</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-AFT-Full"><span class="toc-text">4.2.1 AFT-Full</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-AFT-Local"><span class="toc-text">4.2.2 AFT-Local</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-AFT-Simple"><span class="toc-text">4.2.3 AFT-Simple</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-AFT-Conv"><span class="toc-text">4.2.4 AFT-Conv</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-%E5%8F%82%E6%95%B0%E5%8C%96"><span class="toc-text">4.2.5 参数化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Related-Work"><span class="toc-text">5 Related Work</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E8%BF%91%E4%BC%BC%E7%82%B9%E7%A7%AF"><span class="toc-text">5.1 近似点积</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E7%A8%80%E7%96%8F%E6%B3%A8%E6%84%8F%E5%8A%9B"><span class="toc-text">5.2 稀疏注意力</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8E%8B%E7%BC%A9"><span class="toc-text">5.3 上下文压缩</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E6%B6%88%E9%99%A4%E7%82%B9%E7%A7%AF%E6%B3%A8%E6%84%8F%E5%8A%9B"><span class="toc-text">5.4 消除点积注意力</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-MLPs-for-vision"><span class="toc-text">5.5 MLPs for vision</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-Experiments"><span class="toc-text">6 Experiments</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%9B%BE%E5%83%8F%E8%87%AA%E5%9B%9E%E5%BD%92%E5%BB%BA%E6%A8%A1"><span class="toc-text">6.1 图像自回归建模</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-1-CIFAR-10%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text">6.1.1 CIFAR-10数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-2-%E5%AE%9E%E9%AA%8C%E9%83%A8%E5%88%86"><span class="toc-text">6.1.2 实验部分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8E%E7%8E%B0%E6%9C%89%E6%8A%80%E6%9C%AF%E7%9B%B8%E6%AF%94"><span class="toc-text">与现有技术相比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-2-Factorized%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-text">6.1.2.2 Factorized的影响</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E8%AF%AD%E8%A8%80%E5%BB%BA%E6%A8%A1"><span class="toc-text">6.2 语言建模</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-%E8%A1%A5%E5%85%85"><span class="toc-text">6.2.1 补充</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-Enwik8%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text">6.2.2 Enwik8数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3-%E5%AE%9E%E9%AA%8C%E9%83%A8%E5%88%86"><span class="toc-text">6.2.3 实验部分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-3-1-%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F"><span class="toc-text">6.2.3.1 窗口大小</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-3-2-%E8%BE%83%E9%95%BF%E7%9A%84%E5%BA%8F%E5%88%97%E5%A4%A7%E5%B0%8F"><span class="toc-text">6.2.3.2 较长的序列大小</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB"><span class="toc-text">6.3 图像分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-1-Imagenet-1K%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text">6.3.1 Imagenet-1K数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-2-%E5%AE%9E%E9%AA%8C%E9%83%A8%E5%88%86"><span class="toc-text">6.3.2 实验部分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-2-1-%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-text">6.3.2.1 可视化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-2-2-%E5%8F%AF%E5%8F%98%E5%A4%A7%E5%B0%8F%E8%BE%93%E5%85%A5"><span class="toc-text">6.3.2.2 可变大小输入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-2-3-%E4%B8%8ETransformer%E7%9A%84%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="toc-text">6.3.2.3 与Transformer的兼容性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-2-4-%E5%85%A8%E5%B1%80%E8%BF%9E%E9%80%9A%E6%80%A7"><span class="toc-text">6.3.2.4 全局连通性</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-Conclusions"><span class="toc-text">7 Conclusions</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-Additional-Ablations"><span class="toc-text">8 Additional Ablations</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%85%B6%E4%BB%96%E7%9A%84%E6%B6%88%E8%9E%8D%E5%AE%9E%E9%AA%8C"><span class="toc-text">8.1 其他的消融实验</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline" style="font-size: 17px;"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list" style="font-size: 16px;"><div class="aside-list-item"><a class="thumbnail" href="/2025/05/02/5-%E6%95%B0%E6%8D%AE%E9%9B%86/" title="「HFLLM」5-数据集"><img src="https://cdn.mos.cms.futurecdn.net/gHfBJ6FBHKnLbW36hEDvgV.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="「HFLLM」5-数据集"/></a><div class="content"><a class="title" href="/2025/05/02/5-%E6%95%B0%E6%8D%AE%E9%9B%86/" title="「HFLLM」5-数据集">「HFLLM」5-数据集</a><time datetime="2025-05-02T08:26:25.000Z" title="发表于 2025-05-02 16:26:25">2025-05-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/01/3-%E5%BE%AE%E8%B0%83%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/" title="「HFLLM」3. 微调预训练模型"><img src="https://venturebeat.com/wp-content/uploads/2023/05/Untitled-design-78.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="「HFLLM」3. 微调预训练模型"/></a><div class="content"><a class="title" href="/2025/05/01/3-%E5%BE%AE%E8%B0%83%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/" title="「HFLLM」3. 微调预训练模型">「HFLLM」3. 微调预训练模型</a><time datetime="2025-05-01T02:51:22.000Z" title="发表于 2025-05-01 10:51:22">2025-05-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/17/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB9%EF%BC%9AADSNet/" title="论文精读9：ADSNet"><img src="https://i.ytimg.com/vi/v5BoeTyOAhM/hq720.jpg?sqp=-oaymwE7CK4FEIIDSFryq4qpAy0IARUAAAAAGAElAADIQj0AgKJD8AEB-AH-CYACzgWKAgwIABABGFsgYShlMA8=&amp;rs=AOn4CLChXkjgk_egO-1uGInclI_lQe_MMg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="论文精读9：ADSNet"/></a><div class="content"><a class="title" href="/2025/02/17/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB9%EF%BC%9AADSNet/" title="论文精读9：ADSNet">论文精读9：ADSNet</a><time datetime="2025-02-17T09:09:52.000Z" title="发表于 2025-02-17 17:09:52">2025-02-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/27/2024%E5%B9%B4AI%E5%B9%B4%E5%BA%A6%E5%85%B3%E9%94%AE%E8%AF%8D/" title="2024年AI年度关键词"><img src="https://image.uisdc.com/wp-content/uploads/2025/01/banner2025012108482456.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2024年AI年度关键词"/></a><div class="content"><a class="title" href="/2025/01/27/2024%E5%B9%B4AI%E5%B9%B4%E5%BA%A6%E5%85%B3%E9%94%AE%E8%AF%8D/" title="2024年AI年度关键词">2024年AI年度关键词</a><time datetime="2025-01-27T11:03:16.000Z" title="发表于 2025-01-27 19:03:16">2025-01-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://th.bing.com/th/id/R.c711422d32a03183ff82c805e6837a5b?rik=hgP3vHF2D%2fyCGA&amp;riu=http%3a%2f%2fwww.deeplearningdaily.com%2fwp-content%2fuploads%2f2021%2f06%2funofficial-pytorch-implementation-of-attention-free-transformer-aft-layers_60c5308a5335f.jpeg&amp;ehk=tQubmdKcevvpCuBVL2VoQQ80Z%2bRnw1ORYVBowyf4VyE%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0')"><div id="footer-wrap" style="padding: 5px 5px;"><div class="copyright">&copy;2024 - 2025 By 弘树</div><div id="running-time" style="font-size: 14px;"><script>setInterval(() => {
  let create_time = Math.round((new Date(2024, 1, 23).getTime()) / 1000);
  let timestamp = Math.round((new Date().getTime()) / 1000);
  let second = timestamp - create_time;
  let time = new Array(0, 0, 0, 0, 0);
  if (second >= 365 * 24 * 3600) {
      time[0] = parseInt(second / (365 * 24 * 3600));
      second %= 365 * 24 * 3600;
  }
  if (second >= 24 * 3600) {
      time[1] = parseInt(second / (24 * 3600));
      second %= 24 * 3600;
  }
  if (second >= 3600) {
      time[2] = parseInt(second / 3600);
      second %= 3600;
  }
  if (second >= 60) {
      time[3] = parseInt(second / 60);
      second %= 60;
  }
  if (second > 0) {
      time[4] = second;
  }
  currentTimeHtml = "本站已安全运行 " +
      time[0] + " 年 " +
      (time[1] + 31) + " 天 " +
      time[2] + " 时 " +
      time[3] + " 分 " +
      time[4] + " 秒";
  document.getElementById("running-time").innerHTML = currentTimeHtml;
  }, 1000);</script></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const loadUtterances = () => {
    let ele = document.createElement('script')
    ele.id = 'utterances_comment'
    ele.src = 'https://utteranc.es/client.js'
    ele.setAttribute('repo', 'NoyeArk/noyeark.github.io')
    ele.setAttribute('issue-term', 'pathname')
    const nowTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'photon-dark' : 'github-light'
    ele.setAttribute('theme', nowTheme)
    ele.crossOrigin = 'anonymous'
    ele.async = true
    document.getElementById('utterances-wrap').appendChild(ele)
  }

  const utterancesTheme = theme => {
    const iframe = document.querySelector('.utterances-frame')
    if (iframe) {
      const theme = theme === 'dark' ? 'photon-dark' : 'github-light'
      const message = {
        type: 'set-theme',
        theme: theme
      };
      iframe.contentWindow.postMessage(message, 'https://utteranc.es');
    }
  }

  btf.addGlobalFn('themeChange', utterancesTheme, 'utterances')

  if ('Utterances' === 'Utterances' || !false) {
    if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
    else loadUtterances()
  } else {
    window.loadOtherComment = loadUtterances
  }
})()</script></div><script src="/js/jquery.js"></script><script src="/js/footer.js"></script><script src="/js/nav.js"></script><script>let tianliGPT_postSelector = '\#post \#article-container';let tianliGPT_key = 'iyiSf8ljbaf';</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.12.0"></script></div></div></body></html>